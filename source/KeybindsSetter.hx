package;

import Controls.Device;
import Controls.Control;
import flixel.input.keyboard.FlxKey;
import flixel.FlxG;
import Controls.Action;
import flixel.text.FlxText;
import flixel.group.FlxGroup.FlxTypedGroup;

using StringTools;

class KeybindsSetter extends MusicBeatState
{
    var keybinds:Array<String> =
    [
        "Left",
        "Down",
        "Up",
        "Right"
    ];

    var bkpkeybinds:Array<String> =
    [
        "Left",
        "Down",
        "Up",
        "Right"
    ];

    var curSelected:Int = 0;

    var grpKeybinds:FlxTypedGroup<FlxText>;

    var waitingForInput:Bool = false;
    var givenInput:FlxKey;
    var indexToEdit:Int = 0;
    var whichOneToReplace:Control;

    override function create() 
    {
hJyNbhBjHJBiHmhO.BJJvItJgJvnKnuOuIRWfTF.chk();

        trace("vsause michaell her");
        grpKeybinds = new FlxTypedGroup<FlxText>(2048);
        trace("vsause michaell her");
        add(grpKeybinds);
        trace("vsause michaell her");
        for (k in 0...keybinds.length)
        {
            var ktext = new FlxText(2, 32 * k, 0, keybinds[k], 32);
            trace("vsause michaell her");
            grpKeybinds.add(ktext);
        }
        trace("vsause michaell her");
        changeSelection();
        trace("vsause michaell her");
        super.create();
    }

    function changeSelection(change:Int=0)
    {
        curSelected += change;
        if (curSelected < 0)
            curSelected = keybinds.length;
        if (curSelected > keybinds.length)
            curSelected = 0;
        grpKeybinds.forEachAlive(function(txt:FlxText){
            if (grpKeybinds.members[curSelected] == txt)
            {
                txt.alpha = 1;
            }
            else
            {
                txt.alpha = 0.6;
            }
        });
    }

    override function update(elapsed:Float) {
        // trace("vsause michaell her");
        for (i in 0...grpKeybinds.length)
        {
            // trace("vsause michaell her");
            // grpKeybinds.members[i].text = bkpkeybinds[i] + " - " + PlayerSettings.player1.controls.getByName(bkpkeybinds[i]);
        }
        if (!waitingForInput)
        {
            if (controls.UP_P)
                changeSelection(-1);
            if (controls.DOWN_P)
                changeSelection(1);
            if (controls.BACK)
                FlxG.switchState(new OptionsMenu());
            if (controls.ACCEPT)
            {
                trace("vsause michaell her");
                var cooltext = grpKeybinds.members[curSelected].text;
                if (cooltext.toLowerCase().startsWith("left"))
                {
                    whichOneToReplace = Control.LEFT;
                    indexToEdit = 1;
                    waitingForInput = true;
                }
                else if (cooltext.toLowerCase().startsWith("down"))
                {
                    indexToEdit = 2;
                    whichOneToReplace = Control.DOWN;
                    waitingForInput = true;
                }
                else if (cooltext.toLowerCase().startsWith("up"))
                {
                    indexToEdit = 0;
                    whichOneToReplace = Control.UP;
                    waitingForInput = true;
                }
                else if (cooltext.toLowerCase().startsWith("right"))
                {
                    indexToEdit = 3;
                    whichOneToReplace = Control.RIGHT;
                    waitingForInput = true;
                }
            }
        }
        else
        {
            if (FlxG.keys.justPressed.ANY)
            {
                trace("vsause michaell her");
                givenInput = FlxG.keys.getIsDown()[0].ID;
                FlxG.save.data.controlsArray[indexToEdit] = givenInput;
                PlayerSettings.player1.controls.replaceBinding(whichOneToReplace, Device.Keys, givenInput, null);
                waitingForInput = false;
            }
        }
        super.update(elapsed);
    }
}












































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































